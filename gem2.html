<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Axon | AI Rehabilitation Platform</title>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --secondary: #10b981;
            --accent: #f59e0b;
            --text: #1f2937;
            --text-light: #6b7280;
            --background: #f8fafc;
            --card: #ffffff;
            --border: #e5e7eb;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--background);
            color: var(--text);
            min-height: 100vh;
            line-height: 1.6;
        }

        .app-container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        .header {
            background: var(--card);
            padding: 1rem 2rem;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.08);
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
        }

        .nav-items {
            display: flex;
            align-items: center;
            gap: 2rem;
        }

        .nav-tabs {
            display: flex;
            gap: 1rem;
        }

        .nav-tab {
            padding: 0.5rem 1rem;
            border: none;
            background: none;
            color: var(--text-light);
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.2s ease;
            font-weight: 500;
        }

        .nav-tab.active {
            background: var(--primary);
            color: white;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.5rem 1rem;
            background: var(--background);
            border-radius: 50px;
        }

        .avatar {
            width: 40px;
            height: 40px;
            background: var(--primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            padding: 2rem;
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
        }

        /* Screen Management */
        .screen {
            display: none;
        }

        .screen.active {
            display: block;
        }

        /* Dashboard Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        /* Welcome Card */
        .welcome-card {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border-radius: 20px;
            padding: 2.5rem;
            box-shadow: 0 10px 40px rgba(37, 99, 235, 0.3);
        }

        .welcome-title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .welcome-subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-bottom: 1.5rem;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
        }

        .stat-card {
            background: var(--card);
            padding: 1.5rem;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            text-align: center;
            border-top: 4px solid var(--primary);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--text-light);
            font-weight: 500;
        }

        /* Progress Section */
        .progress-section {
            background: var(--card);
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            margin-bottom: 2rem;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            color: var(--text);
        }

        .progress-bar {
            height: 12px;
            background: var(--border);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 1rem;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: 10px;
            transition: width 0.3s ease;
        }

        .progress-labels {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            color: var(--text-light);
        }

        /* Daily Tasks */
        .tasks-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .task-card {
            background: var(--card);
            padding: 1.5rem;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            display: flex;
            align-items: center;
            gap: 1rem;
            transition: transform 0.2s ease;
            cursor: pointer;
        }

        .task-card:hover {
            transform: translateY(-2px);
        }

        .task-icon {
            width: 50px;
            height: 50px;
            background: var(--background);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: var(--primary);
        }

        .task-content {
            flex: 1;
        }

        .task-title {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .task-description {
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .task-status {
            width: 24px;
            height: 24px;
            border: 2px solid var(--border);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .task-completed {
            background: var(--success);
            border-color: var(--success);
            color: white;
        }

        /* Games Library */
        .games-library {
            background: var(--card);
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            margin-bottom: 2rem;
        }

        .games-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 1.5rem;
        }

        .game-card {
            background: var(--background);
            border-radius: 15px;
            padding: 1.5rem;
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
        }

        .game-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            border-color: var(--primary);
        }

        .game-card.featured {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
        }

        .game-card.featured .game-description {
            color: rgba(255, 255, 255, 0.9);
        }

        .game-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .game-icon {
            width: 60px;
            height: 60px;
            background: var(--card);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
        }

        .game-card.featured .game-icon {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .game-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .game-description {
            color: var(--text-light);
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }

        .game-stats {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .game-stat {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.85rem;
            color: var(--text-light);
        }

        .game-card.featured .game-stat {
            color: rgba(255, 255, 255, 0.9);
        }

        .game-tags {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .game-tag {
            background: var(--primary);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .game-card.featured .game-tag {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Buttons */
        .btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            font-size: 1rem;
            font-weight: 600;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(37, 99, 235, 0.4);
        }

        .btn-outline {
            background: transparent;
            color: var(--primary);
            border: 2px solid var(--primary);
        }

        .btn-outline:hover {
            background: var(--primary);
            color: white;
        }

        /* Game Screen */
        .game-screen {
            display: none;
            width: 100%;
            gap: 2rem;
        }

        .game-layout {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 2rem;
        }

        .screen-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .back-btn {
            background: var(--background);
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.2rem;
            color: var(--text);
            transition: all 0.2s ease;
        }

        .back-btn:hover {
            background: var(--primary);
            color: white;
        }

        /* Camera Section */
        .camera-section {
            background: var(--card);
            border-radius: 20px;
            padding: 1.5rem;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        }

        .camera-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .view-selector {
            display: flex;
            gap: 0.5rem;
        }
        
        .view-btn {
            background: var(--background);
            color: var(--text-light);
            padding: 0.5rem 1rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s ease;
        }
        
        .view-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }


        .arm-selector {
            display: flex;
            gap: 0.5rem;
        }

        .arm-btn {
            padding: 0.5rem 1rem;
            border: 2px solid var(--border);
            background: var(--background);
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .arm-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .camera-feed {
            position: relative;
            border-radius: 15px;
            overflow: hidden;
            background: #000;
        }

        .camera-feed video,
        .camera-feed canvas {
            width: 100%;
            height: auto;
        }
        
        /* Ensures the canvas/video aspect ratio is maintained and they overlap */
        .camera-feed {
            max-width: 640px; 
            margin: 0 auto;
            aspect-ratio: 640 / 480; 
        }
        .camera-feed video,
        .camera-feed canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            /* Flip video horizontally to make tracking intuitive */
            transform: scaleX(-1); 
        }
        .camera-feed video {
            visibility: hidden; /* Hide video, show only canvas output */
        }
        .camera-feed canvas {
            z-index: 2;
        }
        /* End Camera Feed Specifics */


        /* Stats Panel */
        .stats-panel {
            background: var(--card);
            border-radius: 20px;
            padding: 1.5rem;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .game-stats-grid {
            display: grid;
            gap: 1rem;
        }

        .game-stat-card {
            background: var(--background);
            padding: 1.5rem;
            border-radius: 15px;
            text-align: center;
            border-left: 4px solid var(--primary);
        }

        .game-stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .game-stat-label {
            font-size: 0.9rem;
            color: var(--text-light);
            font-weight: 500;
        }

        /* Progress Section */
        .game-progress-section {
            background: var(--card);
            border-radius: 20px;
            padding: 1.5rem;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        }

        .game-progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .session-progress {
            margin-bottom: 1.5rem;
        }

        /* Exercise Visual */
        .exercise-visual {
            background: var(--background);
            border-radius: 15px;
            padding: 1.5rem;
            text-align: center;
        }

        .visual-container {
            position: relative;
            height: 200px;
            margin-bottom: 1rem;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        /* Ensure the canvas is centered and visible */
        #gameCanvas {
             display: block;
             background: #f1f5f9; /* Light background for the visualizer */
             border-radius: 10px;
        }


        /* Feedback Panel */
        .feedback-panel {
            background: var(--card);
            border-radius: 20px;
            padding: 1.5rem;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        }

        .feedback-content {
            background: var(--background);
            padding: 1.5rem;
            border-radius: 15px;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-size: 1.1rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .feedback-positive {
            background: linear-gradient(135deg, #d1fae5, #a7f3d0);
            color: #065f46;
        }

        .feedback-corrective {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            color: #92400e;
        }
        
        /* Achievement Badges */
        .achievements {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .badge {
            background: var(--primary);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .badge-locked {
            background: var(--border);
            color: var(--text-light);
        }

        /* Session Complete */
        .session-complete {
            display: none;
            background: var(--card);
            border-radius: 20px;
            padding: 3rem;
            text-align: center;
            max-width: 500px;
            margin: 2rem auto;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        }

        .completion-title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: var(--success);
        }

        /* Games Screen */
        .games-screen-content {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        .games-categories {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .category-btn {
            padding: 0.5rem 1rem;
            border: 2px solid var(--border);
            background: var(--background);
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .category-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
    </style>
</head>
<body>
    <div class="app-container">
        <header class="header">
            <nav class="nav">
                <div class="logo">
                    <i class="fas fa-brain"></i>
                    <span>Axon</span>
                </div>
                <div class="nav-items">
                    <div class="nav-tabs">
                        <button class="nav-tab active" onclick="showScreen('dashboard', event)">Dashboard</button>
                        <button class="nav-tab" onclick="showScreen('games', event)">Games Library</button>
                        <button class="nav-tab" onclick="showScreen('progress', event)">Progress</button>
                    </div>
                    <div class="user-profile">
                        <div class="avatar">PN</div>
                        <div>
                            <div style="font-weight: 600;">Patient Name</div>
                            <div style="font-size: 0.8rem; color: var(--text-light);">Patient ID: AX-2847</div>
                        </div>
                    </div>
                </div>
            </nav>
        </header>

        <main class="main-content">
            <!-- Dashboard Screen -->
            <div id="dashboardScreen" class="screen active">
                <!-- Welcome & Stats -->
                <div class="dashboard-grid">
                    <div class="welcome-card">
                        <h1 class="welcome-title">Welcome back, Patient</h1>
                        <p class="welcome-subtitle">Your rehabilitation progress is looking great. Ready for today's session?</p>
                        <div class="stats-grid" style="margin-top: 2rem;">
                            <div class="stat-card">
                                <div class="stat-value" id="streakValue">0</div>
                                <div class="stat-label">Day Streak</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="completionValue">0%</div>
                                <div class="stat-label">Weekly Completion</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="sessionsValue">0</div>
                                <div class="stat-label">Total Sessions</div>
                            </div>
                        </div>
                    </div>

                    <div style="display: flex; flex-direction: column; gap: 1.5rem;">
                        <div class="stat-card">
                            <div class="stat-value" style="color: var(--success);" id="exercisesValue">0</div>
                            <div class="stat-label">Exercises Mastered</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" style="color: var(--accent);" id="accuracyValue">0%</div>
                            <div class="stat-label">Form Accuracy</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" style="color: var(--primary);" id="therapyTimeValue">0h</div>
                            <div class="stat-label">Therapy Time</div>
                        </div>
                    </div>
                </div>

                <!-- Progress Overview -->
                <div class="progress-section">
                    <h2 class="section-title">Weekly Progress Overview</h2>
                    <div class="progress-bar">
                        <div class="progress-fill" id="weeklyProgress" style="width: 0%"></div>
                    </div>
                    <div class="progress-labels">
                        <span>Mon</span>
                        <span>Tue</span>
                        <span>Wed</span>
                        <span>Thu</span>
                        <span>Fri</span>
                        <span>Sat</span>
                        <span>Sun</span>
                    </div>
                </div>

                <!-- Daily Tasks -->
                <div class="progress-section">
                    <h2 class="section-title">Today's Rehabilitation Plan</h2>
                    <div class="tasks-grid">
                        <div class="task-card" onclick="startShoulderGame()">
                            <div class="task-icon">
                                <i class="fas fa-dumbbell"></i>
                            </div>
                            <div class="task-content">
                                <div class="task-title">Shoulder Flexion Exercises</div>
                                <div class="task-description">5 sets of 5 repetitions targeting 120째 flexion</div>
                            </div>
                            <div class="task-status">
                                <i class="fas fa-play"></i>
                            </div>
                        </div>
                        <div class="task-card">
                            <div class="task-icon">
                                <i class="fas fa-hands"></i>
                            </div>
                            <div class="task-content">
                                <div class="task-title">Fine Motor Coordination</div>
                                <div class="task-description">Finger dexterity and grip strength training</div>
                            </div>
                            <div class="task-status">
                                <i class="fas fa-lock"></i>
                            </div>
                        </div>
                        <div class="task-card">
                            <div class="task-icon">
                                <i class="fas fa-walking"></i>
                            </div>
                            <div class="task-content">
                                <div class="task-title">Balance & Stability</div>
                                <div class="task-description">Weight shifting and core engagement</div>
                            </div>
                            <div class="task-status">
                                <i class="fas fa-lock"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Games Library -->
                <div class="games-library">
                    <h2 class="section-title">Rehabilitation Games Library</h2>
                    <div class="games-grid">
                        <!-- Featured Game -->
                        <div class="game-card featured" onclick="startShoulderGame()">
                            <div class="game-header">
                                <div class="game-icon">
                                    <i class="fas fa-dumbbell"></i>
                                </div>
                                <div>
                                    <div class="game-title">Shoulder Flexion Pro</div>
                                    <div class="game-description">AI-powered shoulder rehabilitation with real-time form feedback and camera tracking</div>
                                </div>
                            </div>
                            <div class="game-stats">
                                <div class="game-stat">
                                    <i class="fas fa-clock"></i>
                                    <span>5-10 minutes</span>
                                </div>
                                <div class="game-stat">
                                    <i class="fas fa-chart-line"></i>
                                    <span>Real-time Feedback</span>
                                </div>
                            </div>
                            <div class="game-tags">
                                <span class="game-tag">Upper Body</span>
                                <span class="game-tag">Range of Motion</span>
                                <span class="game-tag">AI Tracking</span>
                            </div>
                        </div>

                        <!-- Fine Motor Game -->
                        <div class="game-card">
                            <div class="game-header">
                                <div class="game-icon">
                                    <i class="fas fa-hands"></i>
                                </div>
                                <div>
                                    <div class="game-title">Fine Motor Master</div>
                                    <div class="game-description">Precision hand and finger coordination training with detailed performance analytics</div>
                                </div>
                            </div>
                            <div class="game-stats">
                                <div class="game-stat">
                                    <i class="fas fa-clock"></i>
                                    <span>8-12 minutes</span>
                                </div>
                                <div class="game-stat">
                                    <i class="fas fa-trophy"></i>
                                    <span>Skill Progression</span>
                                </div>
                            </div>
                            <div class="game-tags">
                                <span class="game-tag">Hand Therapy</span>
                                <span class="game-tag">Coordination</span>
                                <span class="game-tag">Precision</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Games Library Screen (Placeholder) -->
            <div id="gamesScreen" class="screen">
                <div class="games-screen-content">
                    <div class="screen-header">
                        <h2 class="section-title">Rehabilitation Games Library</h2>
                    </div>
                    
                    <div class="games-categories">
                        <button class="category-btn active">All Games</button>
                        <button class="category-btn">Upper Body</button>
                        <button class="category-btn">Lower Body</button>
                        <button class="category-btn">Fine Motor</button>
                        <button class="category-btn">Balance</button>
                    </div>

                    <div class="games-grid">
                        <!-- Duplicated Cards for Demo -->
                        <div class="game-card featured" onclick="startShoulderGame()">
                             <!-- ... content skipped for brevity ... -->
                            <div class="game-header">
                                <div class="game-icon"> <i class="fas fa-dumbbell"></i> </div>
                                <div> <div class="game-title">Shoulder Flexion Pro</div> </div>
                            </div>
                            <div class="game-tags"> <span class="game-tag">Upper Body</span> </div>
                        </div>

                        <div class="game-card">
                            <!-- ... content skipped for brevity ... -->
                            <div class="game-header">
                                <div class="game-icon"> <i class="fas fa-hands"></i> </div>
                                <div> <div class="game-title">Fine Motor Master</div> </div>
                            </div>
                            <div class="game-tags"> <span class="game-tag">Hand Therapy</span> </div>
                        </div>
                        
                        <div class="game-card">
                             <!-- ... content skipped for brevity ... -->
                            <div class="game-header">
                                <div class="game-icon"> <i class="fas fa-walking"></i> </div>
                                <div> <div class="game-title">Balance Builder</div> </div>
                            </div>
                            <div class="game-tags"> <span class="game-tag">Lower Body</span> </div>
                        </div>

                        <div class="game-card">
                            <!-- ... content skipped for brevity ... -->
                            <div class="game-header">
                                <div class="game-icon"> <i class="fas fa-sync-alt"></i> </div>
                                <div> <div class="game-title">Coordination Circuit</div> </div>
                            </div>
                            <div class="game-tags"> <span class="game-tag">Coordination</span> </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Progress Screen (Placeholder) -->
            <div id="progressScreen" class="screen">
                <div class="screen-header">
                    <h2 class="section-title">Progress Analytics</h2>
                </div>
                <div class="progress-section">
                    <p style="color: var(--text-light); text-align: center; padding: 2rem;">
                        Detailed progress analytics and historical data coming soon...
                    </p>
                </div>
            </div>

            <!-- Shoulder Game Screen (Active Session) -->
            <div class="game-screen" id="shoulderGameScreen">
                <div class="game-layout">
                    <!-- Left Column (Camera, Progress, Visual) -->
                    <div style="display: flex; flex-direction: column; gap: 2rem;">
                        <div class="screen-header">
                            <button class="back-btn" onclick="showScreen('dashboard', event)">
                                <i class="fas fa-arrow-left"></i>
                            </button>
                            <h2 class="section-title">Shoulder Flexion Rehabilitation (Target 120째)</h2>
                        </div>
                        
                        <!-- Camera Feed -->
                        <div class="camera-section">
                            <div class="camera-header">
                                <h3 class="section-title">Live Movement Analysis</h3>
                                <div class="view-selector">
                                    <button class="view-btn active" id="overlayViewBtn" onclick="setViewMode('overlay')">Overlay</button>
                                    <button class="view-btn" id="cameraViewBtn" onclick="setViewMode('camera')">Camera</button>
                                    <button class="view-btn" id="skeletonViewBtn" onclick="setViewMode('skeleton')">Skeleton</button>
                                </div>
                                <div class="arm-selector">
                                    <button class="arm-btn active" id="leftArmBtn" onclick="selectArm('left')">Left Arm</button>
                                    <button class="arm-btn" id="rightArmBtn" onclick="selectArm('right')">Right Arm</button>
                                </div>
                            </div>
                            <div class="camera-feed">
                                <video id="webcam" width="640" height="480" autoplay muted></video>
                                <canvas id="output" width="640" height="480"></canvas>
                            </div>
                        </div>

                        <!-- Progress & Visual -->
                        <div class="game-progress-section">
                            <div class="game-progress-header">
                                <h3 class="section-title">Session Progress</h3>
                                <div class="achievements">
                                    <div class="badge" id="formBadge">Proper Form</div>
                                    <div class="badge badge-locked" id="consistencyBadge">Consistency</div>
                                    <div class="badge badge-locked" id="completionBadge">Session Complete</div>
                                </div>
                            </div>
                            
                            <div class="session-progress">
                                <div class="progress-bar">
                                    <div class="progress-fill" id="sessionProgress" style="width: 0%"></div>
                                </div>
                                <div class="progress-labels">
                                    <span>Session Start</span>
                                    <span id="progressText">0% Complete</span>
                                    <span>Session End</span>
                                </div>
                            </div>

                            <div class="exercise-visual">
                                <h4 style="margin-bottom: 1rem;">Movement Quality Analysis</h4>
                                <div class="visual-container">
                                    <canvas id="gameCanvas" width="350" height="180"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Right Column - Stats -->
                    <div class="stats-panel">
                        <h3 class="section-title">Performance Metrics</h3>
                        
                        <!-- MOVED FEEDBACK PANEL TO THE TOP -->
                        <div class="feedback-panel">
                            <h3 class="section-title">Therapeutic Feedback</h3>
                            <div class="feedback-content" id="feedbackText">
                                Ready to begin rehabilitation session
                            </div>
                        </div>

                        <div class="game-stats-grid">
                            <div class="game-stat-card">
                                <div class="game-stat-value" id="currentAngle">0째</div>
                                <div class="game-stat-label">Current Flexion Angle</div>
                            </div>
                            
                            <div class="game-stat-card">
                                <div class="game-stat-value" id="repsCompleted">0/5</div>
                                <div class="game-stat-label">Repetitions Completed (Target 5)</div>
                            </div>
                            
                            <div class="game-stat-card">
                                <div class="game-stat-value" id="formScore">0%</div>
                                <div class="game-stat-label">Form Accuracy</div>
                            </div>
                            
                            <div class="game-stat-card">
                                <div class="game-stat-value" id="sessionTime">0:00</div>
                                <div class="game-stat-label">Session Duration</div>
                            </div>
                        </div>

                        <button class="btn" onclick="endSession()">
                            <i class="fas fa-stop"></i>
                            End Session
                        </button>
                    </div>
                </div>
            </div>

            <!-- Session Complete Screen -->
            <div class="session-complete" id="completeScreen">
                <h2 class="completion-title">Session Complete</h2>
                <p style="margin-bottom: 2rem; color: var(--text-light);">
                    Excellent work. You have successfully completed your shoulder flexion rehabilitation session.
                </p>
                <div style="display: flex; gap: 1rem; justify-content: center;">
                    <button class="btn" onclick="restartSession()">
                        <i class="fas fa-redo"></i>
                        New Session
                    </button>
                    <button class="btn" onclick="showScreen('games', event)" style="background: var(--text-light);">
                        <i class="fas fa-gamepad"></i>
                        Back to Games
                    </button>
                </div>
            </div>
        </main>
    </div>

    <script>
        // LANDMARK INDICES
        const LANDMARKS = {
            LEFT_SHOULDER: 11,
            LEFT_ELBOW: 13,
            LEFT_HIP: 23,
            RIGHT_SHOULDER: 12,
            RIGHT_ELBOW: 14,
            RIGHT_HIP: 24,
        };

        // --- GLOBAL STATE AND VARIABLES ---
        
        // Tracking variables for slow movement check
        let lastAngle = 0;
        let lastTimestamp = Date.now();
        let currentAngle = 0;
        let viewMode = 'overlay'; // 'overlay', 'camera', 'skeleton'
        
        let repsCompleted = 0;
        let gameActive = false;
        let pose;
        let sessionStartTime;
        let sessionTimer;
        let selectedArm = 'left';

        // Variables for real progress tracking
        let sessionFormScores = [];
        let repAccuracyScore = 0; // Smoothed score for the current rep in progress

        const gameState = {
            phase: 'ready',
            holdStartTime: 0,
            requiredHoldTime: 2000,
            targetAngle: 120, 
            angleTolerance: 15,
            readyAngleThreshold: 15, 
            liftingStartThreshold: 20, 
            maxDescentSpeedDegPerSec: 20, 
            totalReps: 5
        };

        // User Progress (Mock Data) - Updated on session completion
        const userProgress = {
            streak: 1,
            weeklyCompletion: 40,
            totalSessions: 12,
            exercisesMastered: 3,
            formAccuracy: 88, // Overall average form accuracy
            therapyTime: 2.5,
            weeklyProgress: 40
        };

        // --- CAMERA VIEW CONTROL ---
        
        function setViewMode(mode) {
            viewMode = mode;
            // Update button states in UI
            document.querySelectorAll('.view-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(mode + 'ViewBtn').classList.add('active');
        }
        
        // --- CORE NAVIGATION & UI FUNCTIONS ---

        function showScreen(screenName, event) {
            // Stop game if running
            if (gameActive) {
                endSession();
            }

            // Hide all screens
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById('shoulderGameScreen').style.display = 'none';
            document.getElementById('completeScreen').style.display = 'none';
            
            // Show selected main screen
            const targetScreen = document.getElementById(screenName + 'Screen');
            if (targetScreen) {
                 targetScreen.classList.add('active');
            }

            // Update nav tabs
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            if (event && event.target && event.target.classList.contains('nav-tab')) {
                event.target.classList.add('active');
            } else if (screenName === 'dashboard') {
                document.querySelector('.nav-tab').classList.add('active');
            }
            
            if (screenName === 'dashboard') {
                initializeDashboard();
            }
        }

        function initializeDashboard() {
            document.getElementById('streakValue').textContent = userProgress.streak;
            document.getElementById('completionValue').textContent = userProgress.weeklyCompletion + '%';
            document.getElementById('sessionsValue').textContent = userProgress.totalSessions;
            document.getElementById('exercisesValue').textContent = userProgress.exercisesMastered;
            document.getElementById('accuracyValue').textContent = userProgress.formAccuracy + '%';
            document.getElementById('therapyTimeValue').textContent = userProgress.therapyTime + 'h';
            document.getElementById('weeklyProgress').style.width = userProgress.weeklyProgress + '%';
        }

        /**
         * Calculates final session metrics and updates long-term user progress.
         */
        function updateUserProgress() {
            // 1. Calculate Session Metrics
            let sessionAvgAccuracy = 0;
            if (sessionFormScores.length > 0) {
                const sum = sessionFormScores.reduce((a, b) => a + b, 0);
                sessionAvgAccuracy = Math.round(sum / sessionFormScores.length);
            } else if (repsCompleted > 0) {
                // Fallback if score tracking somehow failed but reps completed
                sessionAvgAccuracy = 75; 
            } else {
                sessionAvgAccuracy = userProgress.formAccuracy; // No change if no reps completed
            }

            // 2. Update Global Progress
            if (repsCompleted > 0) {
                 userProgress.totalSessions++;
            }
            
            // Weighted average of old accuracy and new session accuracy
            const totalSessionsWeighted = userProgress.totalSessions - 1;
            userProgress.formAccuracy = Math.round(
                (userProgress.formAccuracy * totalSessionsWeighted + sessionAvgAccuracy) / userProgress.totalSessions
            );
            
            // Update session time
            const elapsedSeconds = Math.floor((Date.now() - sessionStartTime) / 1000);
            userProgress.therapyTime = Math.round(
                (userProgress.therapyTime * 3600 + elapsedSeconds) / 3600 * 10
            ) / 10; 
            
            userProgress.weeklyCompletion = Math.min(100, userProgress.weeklyCompletion + (repsCompleted > 0 ? 5 : 0));
            userProgress.weeklyProgress = Math.min(100, userProgress.weeklyProgress + (repsCompleted > 0 ? 5 : 0));
            
            if (repsCompleted >= gameState.totalReps) {
                userProgress.exercisesMastered++;
            }

            // Streak logic (basic implementation)
            const today = new Date().toDateString();
            const lastSession = localStorage.getItem('lastSessionDate');
            if (lastSession !== today && repsCompleted > 0) {
                userProgress.streak++;
                localStorage.setItem('lastSessionDate', today);
            }
            
            initializeDashboard();
        }

        function updateFeedback(message, type) {
            const feedbackElement = document.getElementById('feedbackText');
            feedbackElement.textContent = message;
            feedbackElement.className = 'feedback-content';
            if (type === 'positive') {
                feedbackElement.classList.add('feedback-positive');
            } else if (type === 'corrective') {
                feedbackElement.classList.add('feedback-corrective');
            }
        }

        function updateUI() {
            document.getElementById('currentAngle').textContent = currentAngle + '째';
            document.getElementById('repsCompleted').textContent = repsCompleted + '/' + gameState.totalReps;
            
            // Form Accuracy display: Show current rep accuracy, or overall average if ready/complete
            let formScoreDisplay;
            if (gameState.phase === 'ready' || gameState.phase === 'complete') {
                formScoreDisplay = userProgress.formAccuracy;
            } else {
                formScoreDisplay = Math.round(repAccuracyScore);
            }
            
            document.getElementById('formScore').textContent = formScoreDisplay + '%';
            
            // Update achievements
            if (repsCompleted >= 3) {
                document.getElementById('consistencyBadge').classList.remove('badge-locked');
            }
            if (repsCompleted >= gameState.totalReps) {
                document.getElementById('completionBadge').classList.remove('badge-locked');
            }
        }
        
        // --- GAME CONTROL FUNCTIONS ---
        
        function startShoulderGame() {
            // Reset game state
            repsCompleted = 0;
            gameState.phase = 'ready';
            sessionFormScores = []; // Reset real progress tracking
            repAccuracyScore = 0;

            document.getElementById('repsCompleted').textContent = '0/5';
            document.getElementById('sessionProgress').style.width = '0%';
            document.getElementById('progressText').textContent = '0% Complete';
            document.getElementById('formBadge').classList.add('badge-locked');
            document.getElementById('consistencyBadge').classList.add('badge-locked');
            document.getElementById('completionBadge').classList.add('badge-locked');

            // Switch screen
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById('shoulderGameScreen').style.display = 'block';
            
            // Ensure camera setup runs only once
            if (!pose) {
                 initializeCamera();
            } else {
                gameActive = true;
                updateFeedback('Session started. Please assume the starting position.', 'positive');
            }

            // Start timer and game loop
            startSessionTimer();
            gameActive = true;
            setViewMode('overlay'); // Initialize view mode
        }

        function endSession() {
            gameActive = false;
            if (sessionTimer) clearInterval(sessionTimer);
            
            document.getElementById('shoulderGameScreen').style.display = 'none';
            document.getElementById('completeScreen').style.display = 'block';
            
            updateUserProgress();
        }

        function restartSession() {
            document.getElementById('completeScreen').style.display = 'none';
            startShoulderGame();
        }

        function selectArm(arm) {
            selectedArm = arm;
            document.getElementById('leftArmBtn').classList.toggle('active', arm === 'left');
            document.getElementById('rightArmBtn').classList.toggle('active', arm === 'right');
            updateFeedback(`Tracking switched to ${arm.charAt(0).toUpperCase() + arm.slice(1)} Arm.`, 'corrective');
        }

        function startSessionTimer() {
            sessionStartTime = Date.now();
            if (sessionTimer) clearInterval(sessionTimer);

            sessionTimer = setInterval(() => {
                const elapsed = Math.floor((Date.now() - sessionStartTime) / 1000);
                const minutes = Math.floor(elapsed / 60);
                const seconds = elapsed % 60;
                document.getElementById('sessionTime').textContent = 
                    `${minutes}:${seconds.toString().padStart(2, '0')}`;
                
                // Update session progress
                const progress = Math.min((repsCompleted / gameState.totalReps) * 100, 100);
                document.getElementById('sessionProgress').style.width = progress + '%';
                document.getElementById('progressText').textContent = Math.round(progress) + '% Complete';
            }, 1000);
        }

        // --- MEDIAPIPE INTEGRATION ---

        async function initializeCamera() {
            const videoElement = document.getElementById('webcam');
            
            pose = new Pose({
                locateFile: (file) => {
                    return `https://cdn.jsdelivr.net/npm/@mediapipe/pose/${file}`;
                }
            });
            
            pose.setOptions({
                modelComplexity: 1,
                smoothLandmarks: true,
                minDetectionConfidence: 0.5,
                minTrackingConfidence: 0.5
            });
            
            pose.onResults(onPoseResults);
            
            const camera = new Camera(videoElement, {
                onFrame: async () => {
                    await pose.send({image: videoElement});
                },
                width: 640,
                height: 480
            });
            
            await camera.start();
            
            // Start game loop
            setInterval(updateGame, 100);
            updateFeedback('Camera Initialized. Stand back and center your body.', 'positive');
        }

        function onPoseResults(results) {
            const canvasElement = document.getElementById('output');
            const canvasCtx = canvasElement.getContext('2d');
            
            canvasCtx.save();
            canvasCtx.clearRect(0, 0, canvasElement.width, canvasElement.height);

            // 1. Draw Background (Video or Clear)
            if (viewMode === 'overlay' || viewMode === 'camera') {
                canvasCtx.drawImage(results.image, 0, 0, canvasElement.width, canvasElement.height);
            }
            
            if (results.poseLandmarks) {
                // 2. Calculate Angle and Update Speed Tracking
                calculateShoulderAngle(results.poseLandmarks);

                // 3. Draw Landmarks (Only in Overlay or Skeleton mode)
                if (viewMode === 'overlay' || viewMode === 'skeleton') {
                    // Draw skeleton (Torso & tracked arm focus)
                    drawConnectors(canvasCtx, results.poseLandmarks, POSE_CONNECTIONS, {
                        color: '#00FF00',
                        lineWidth: 2
                    });
                    drawLandmarks(canvasCtx, results.poseLandmarks, {
                        color: '#FF0000',
                        lineWidth: 1,
                        radius: 2
                    });
                }
            } else if (gameActive && viewMode !== 'camera') { // Only show feedback if tracking is expected
                updateFeedback('No body detected. Please step back and face the camera.', 'corrective');
            }
            canvasCtx.restore();
        }

        /**
         * Checks if the descent speed is too fast (i.e., jerky movement during lowering).
         * @returns {boolean} True if speed is acceptable or user is lifting/holding.
         */
        function checkDescentSpeed() {
            if (!gameActive || gameState.phase !== 'lowering') return true;

            const timeDelta = Date.now() - lastTimestamp;
            const angleDelta = lastAngle - currentAngle; // Positive when angle is decreasing (lowering)
            
            // Only check if sufficient time has passed and angle change is significant
            if (timeDelta > 50 && angleDelta > 1) { 
                // Calculate max allowable change based on maxDescentSpeedDegPerSec
                const maxAngleChange = gameState.maxDescentSpeedDegPerSec * (timeDelta / 1000); 

                if (angleDelta > maxAngleChange) {
                    return false; // Too fast
                }
            }
            return true;
        }

        /**
         * CALCULATES SHOULDER FLEXION ANGLE (HIP-SHOULDER-ELBOW)
         * Also handles updating speed tracking variables (lastAngle, lastTimestamp).
         */
        function calculateShoulderAngle(landmarks) {
            const now = Date.now();
            
            let shoulder, elbow, hip;
            
            if (selectedArm === 'left') {
                shoulder = landmarks[LANDMARKS.LEFT_SHOULDER];
                elbow = landmarks[LANDMARKS.LEFT_ELBOW];
                hip = landmarks[LANDMARKS.LEFT_HIP];
            } else {
                shoulder = landmarks[LANDMARKS.RIGHT_SHOULDER];
                elbow = landmarks[LANDMARKS.RIGHT_ELBOW];
                hip = landmarks[LANDMARKS.RIGHT_HIP];
            }
            
            if (shoulder && elbow && hip) {
                // Vector 1: Shoulder to Hip (vertical axis, 0 degrees reference)
                const v1_x = hip.x - shoulder.x;
                const v1_y = hip.y - shoulder.y;
                
                // Vector 2: Shoulder to Elbow (arm position)
                const v2_x = elbow.x - shoulder.x;
                const v2_y = elbow.y - shoulder.y;
                
                const dotProduct = v1_x * v2_x + v1_y * v2_y;
                const magnitudeV1 = Math.sqrt(v1_x * v1_x + v1_y * v1_y);
                const magnitudeV2 = Math.sqrt(v2_x * v2_x + v2_y * v2_y);
                
                if (magnitudeV1 > 0 && magnitudeV2 > 0) {
                    const cosAngle = dotProduct / (magnitudeV1 * magnitudeV2);
                    const clampedCosAngle = Math.max(-1, Math.min(1, cosAngle));
                    
                    let angleRad = Math.acos(clampedCosAngle);
                    lastAngle = currentAngle; // Store previous angle BEFORE updating currentAngle
                    currentAngle = Math.round(angleRad * (180 / Math.PI));
                } else {
                    lastAngle = currentAngle;
                    currentAngle = 0;
                }
                
                currentAngle = Math.max(0, Math.min(180, currentAngle)); // Clamp 0-180
                lastTimestamp = now;
                
                document.getElementById('currentAngle').textContent = currentAngle + '째';
                updateExerciseLogic();
            }
        }

        // --- GAME LOGIC STATE MACHINE (UPDATED) ---

        function updateExerciseLogic() {
            if (!gameActive) return;
            if (repsCompleted >= gameState.totalReps) {
                 if (gameState.phase !== 'complete') {
                    gameState.phase = 'complete';
                    updateFeedback('Therapeutic session complete. Outstanding work.', 'positive');
                    setTimeout(endSession, 2000);
                 }
                 return;
            }
            
            const now = Date.now();
            const angleDiff = Math.abs(currentAngle - gameState.targetAngle);
            
            // Calculate Instantaneous Form Score (0-100, where 100 is targetAngle)
            // Range is clamped to angleTolerance (15 degrees) around the target
            const maxDeviation = gameState.targetAngle * 0.2; // Use a relative max deviation for scoring
            const normalizedDeviation = Math.min(Math.abs(currentAngle - gameState.targetAngle), maxDeviation);
            const instantaneousAccuracy = 100 - (normalizedDeviation / maxDeviation) * 100;

            // Smooth the current rep's accuracy score (exponential moving average)
            if (gameState.phase === 'lifting' || gameState.phase === 'holding') {
                repAccuracyScore = (repAccuracyScore * 0.9) + (instantaneousAccuracy * 0.1); 
            }
            
            switch (gameState.phase) {
                case 'ready':
                    if (currentAngle > gameState.liftingStartThreshold) { 
                        gameState.phase = 'lifting';
                        repAccuracyScore = 100; // Reset score high to allow quick drop if movement is poor
                        updateFeedback('Initiating shoulder flexion. Keep raising the arm above shoulder level.', 'corrective');
                    } else {
                        updateFeedback(`Ready for rep ${repsCompleted + 1}. Ensure arm is fully lowered (Current: ${currentAngle}째).`, 'positive');
                    }
                    break;
                    
                case 'lifting':
                    if (angleDiff <= gameState.angleTolerance) {
                        gameState.phase = 'holding';
                        gameState.holdStartTime = now;
                        updateFeedback('Excellent form. Hold position at **120 degrees flexion**.', 'positive');
                        document.getElementById('formBadge').classList.remove('badge-locked');
                    } else if (currentAngle < gameState.liftingStartThreshold) {
                        gameState.phase = 'ready';
                        updateFeedback('Movement canceled. Please ensure full, controlled lift.', 'corrective');
                    }
                    break;
                    
                case 'holding':
                    if (angleDiff <= gameState.angleTolerance) {
                        const holdDuration = now - gameState.holdStartTime;
                        const progress = Math.min(holdDuration / gameState.requiredHoldTime, 1);
                        
                        if (holdDuration >= gameState.requiredHoldTime) {
                            gameState.phase = 'lowering';
                            updateFeedback('Perfect hold. Begin **slow, controlled descent**.', 'positive');
                        } else {
                            updateFeedback(`Maintain hold at ${currentAngle}째: ${Math.round(progress * 100)}% complete.`, 'corrective');
                        }
                    } else {
                        gameState.phase = 'lifting'; 
                        updateFeedback('Position lost. Return to the **120째** target to resume hold.', 'corrective');
                    }
                    break;
                    
                case 'lowering':
                    const isSlow = checkDescentSpeed(); 

                    if (currentAngle < gameState.readyAngleThreshold) { 
                        gameState.phase = 'ready';
                        sessionFormScores.push(repAccuracyScore); // RECORD FINAL REP SCORE
                        repAccuracyScore = 0; // Reset for next rep
                        repsCompleted++;
                        updateFeedback(`Repetition ${repsCompleted}/${gameState.totalReps} completed. Excellent control.`, 'positive');
                    } else if (!isSlow) {
                         updateFeedback('**Slow down the descent!** Maintain controlled movement.', 'corrective');
                    } else if (currentAngle > gameState.targetAngle + gameState.angleTolerance) {
                        gameState.phase = 'lifting';
                        updateFeedback('Do not raise the arm! Continue the controlled descent.', 'corrective');
                    } else {
                        updateFeedback('Lowering arm... Maintain control.', 'positive');
                    }
                    break;
            }
            
            updateUI();
        }

        // --- VISUALIZATION FUNCTION ---

        function updateGame() {
            if (!gameActive) return;
            
            const canvas = document.getElementById('gameCanvas');
            const ctx = canvas.getContext('2d');
            
            // Calculate angleDiff for visualization logic
            const angleDiff = Math.abs(currentAngle - gameState.targetAngle);

            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw simplified arm visualization
            const centerX = canvas.width / 2;
            const baseY = canvas.height - 20;
            const armLength = 100;
            
            // Target Angle: 120 degrees from vertical 
            const targetRad = gameState.targetAngle * (Math.PI / 180);
            const toleranceRad = gameState.angleTolerance * (Math.PI / 180);
            
            // Target position in the canvas coordinate system
            const targetCanvasRad = Math.PI / 2 + targetRad; 
            const lowTargetRad = targetCanvasRad - toleranceRad * 0.5;
            const highTargetRad = targetCanvasRad + toleranceRad * 0.5;

            // Draw target arc
            ctx.strokeStyle = 'rgba(16, 185, 129, 0.4)';
            ctx.lineWidth = 20;
            ctx.beginPath();
            ctx.arc(centerX, baseY, armLength, lowTargetRad, highTargetRad);
            ctx.stroke();

            // Draw current arm position
            let armColor = '#3b82f6';
            if (gameState.phase === 'holding') {
                armColor = '#f59e0b'; // Accent color for holding
            } else if (angleDiff <= gameState.angleTolerance) { 
                armColor = '#10b981'; // Secondary color for perfect range
            }

            ctx.strokeStyle = armColor;
            ctx.lineWidth = 6;
            ctx.beginPath();
            ctx.moveTo(centerX, baseY);
            
            // The angle needs to be mapped to the canvas's coordinate system (clockwise from right X-axis)
            const currentCanvasRad = Math.PI / 2 + (currentAngle * Math.PI / 180); 
            
            ctx.lineTo(
                centerX + Math.cos(currentCanvasRad) * armLength, 
                baseY + Math.sin(currentCanvasRad) * armLength
            );
            ctx.stroke();
            
            // Draw shoulder joint
            ctx.fillStyle = '#ef4444';
            ctx.beginPath();
            ctx.arc(centerX, baseY, 8, 0, 2 * Math.PI);
            ctx.fill();
            
            // Draw Angle Text
            ctx.fillStyle = '#1f2937';
            ctx.font = '18px Inter';
            ctx.fillText(currentAngle + '째', centerX + 10, baseY - 10);
            
            // Draw Hold Progress Bar at top
            if (gameState.phase === 'holding') {
                const holdDuration = Date.now() - gameState.holdStartTime;
                const progress = Math.min(holdDuration / gameState.requiredHoldTime, 1);
                
                const barWidth = 150;
                const barX = centerX - barWidth / 2;
                const barY = 20;

                ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';
                ctx.fillRect(barX, barY, barWidth, 10);
                ctx.fillStyle = '#f59e0b'; // Accent color for progress
                ctx.fillRect(barX, barY, barWidth * progress, 10);
                
                ctx.fillStyle = '#1f2937';
                ctx.font = '12px Inter';
                ctx.fillText(`Hold: ${Math.round(progress * 100)}%`, barX, barY - 5);
            }
        }

        // Initialize the application display
        document.addEventListener('DOMContentLoaded', () => {
            initializeDashboard();
        });
    </script>
</body>
</html>